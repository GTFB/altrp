# üöÄ –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –ø–µ—Ä–≤–æ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è

–°–∏—Å—Ç–µ–º–∞ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–π –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–∏ —Å —Å–æ–∑–¥–∞–Ω–∏–µ–º –ø–µ—Ä–≤–æ–≥–æ –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–∞.

## üìã –ö–∞–∫ —ç—Ç–æ —Ä–∞–±–æ—Ç–∞–µ—Ç

### –ü–µ—Ä–≤—ã–π –∑–∞–ø—É—Å–∫ (–ë–î –ø—É—Å—Ç–∞)

1. –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –æ—Ç–∫—Ä—ã–≤–∞–µ—Ç `/admin`
2. –°–∏—Å—Ç–µ–º–∞ –ø—Ä–æ–≤–µ—Ä—è–µ—Ç –Ω–∞–ª–∏—á–∏–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π –≤ –ë–î —á–µ—Ä–µ–∑ `/api/auth/check-users`
3. –ï—Å–ª–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π –Ω–µ—Ç ‚Üí –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π —Ä–µ–¥–∏—Ä–µ–∫—Ç –Ω–∞ `/admin/create-new-user`
4. –ó–∞–ø–æ–ª–Ω—è–µ—Ç—Å—è —Ñ–æ—Ä–º–∞ —Å–æ–∑–¥–∞–Ω–∏—è –ø–µ—Ä–≤–æ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
5. –û—Ç–ø—Ä–∞–≤–∫–∞ POST –Ω–∞ `/api/auth/create-first-user`
6. –°–æ–∑–¥–∞–µ—Ç—Å—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å —Å —Ä–æ–ª—å—é `admin`
7. –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π –≤—Ö–æ–¥ –∏ —Ä–µ–¥–∏—Ä–µ–∫—Ç –Ω–∞ `/admin`

### –ü–æ—Å–ª–µ–¥—É—é—â–∏–µ –∑–∞–ø—É—Å–∫–∏

1. –ü—Ä–∏ –ø–æ–ø—ã—Ç–∫–µ –æ—Ç–∫—Ä—ã—Ç—å `/admin/create-new-user` ‚Üí —Ä–µ–¥–∏—Ä–µ–∫—Ç –Ω–∞ `/login`
2. –û–±—ã—á–Ω—ã–π –≤—Ö–æ–¥ —á–µ—Ä–µ–∑ `/login`

## üõ£Ô∏è –ú–∞—Ä—à—Ä—É—Ç—ã

### `/admin`
- **–ü—Ä–æ–≤–µ—Ä–∫–∞:** –ï—Å—Ç—å –ª–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏ –≤ –ë–î?
- **–ù–µ—Ç –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π ‚Üí** —Ä–µ–¥–∏—Ä–µ–∫—Ç –Ω–∞ `/admin/create-new-user`
- **–ï—Å—Ç—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏ ‚Üí** –ø–æ–∫–∞–∑–∞—Ç—å –∞–¥–º–∏–Ω-–ø–∞–Ω–µ–ª—å (—Ç—Ä–µ–±—É–µ—Ç—Å—è –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—è)

### `/admin/create-new-user`
- **–ü—Ä–æ–≤–µ—Ä–∫–∞:** –ï—Å—Ç—å –ª–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏ –≤ –ë–î?
- **–ï—Å—Ç—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏ ‚Üí** —Ä–µ–¥–∏—Ä–µ–∫—Ç –Ω–∞ `/login`
- **–ù–µ—Ç –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π ‚Üí** –ø–æ–∫–∞–∑–∞—Ç—å —Ñ–æ—Ä–º—É —Å–æ–∑–¥–∞–Ω–∏—è

### `/login`
- –°—Ç–∞–Ω–¥–∞—Ä—Ç–Ω–∞—è —Ñ–æ—Ä–º–∞ –≤—Ö–æ–¥–∞
- –ü–æ—Å–ª–µ —É—Å–ø–µ—à–Ω–æ–≥–æ –≤—Ö–æ–¥–∞ ‚Üí —Ä–µ–¥–∏—Ä–µ–∫—Ç –Ω–∞ `/admin`

## üì° API Endpoints

### `GET /api/auth/check-users`
–ü—Ä–æ–≤–µ—Ä—è–µ—Ç –Ω–∞–ª–∏—á–∏–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π –≤ –ë–î

**Response:**
```json
{
  "hasUsers": true,
  "count": 5
}
```

### `POST /api/auth/create-first-user`
–°–æ–∑–¥–∞–µ—Ç –ø–µ—Ä–≤–æ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è (—Ç–æ–ª—å–∫–æ –µ—Å–ª–∏ –ë–î –ø—É—Å—Ç–∞)

**Request:**
```json
{
  "email": "admin@example.com",
  "name": "Admin User",
  "password": "securePassword123",
  "confirmPassword": "securePassword123"
}
```

**Validations:**
- ‚úÖ –ü—Ä–æ–≤–µ—Ä–∫–∞, —á—Ç–æ —ç—Ç–æ –ø–µ—Ä–≤—ã–π –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å
- ‚úÖ –í—Å–µ –ø–æ–ª—è –æ–±—è–∑–∞—Ç–µ–ª—å–Ω—ã
- ‚úÖ –ü–∞—Ä–æ–ª–∏ —Å–æ–≤–ø–∞–¥–∞—é—Ç
- ‚úÖ –ú–∏–Ω–∏–º—É–º 8 —Å–∏–º–≤–æ–ª–æ–≤ –≤ –ø–∞—Ä–æ–ª–µ
- ‚úÖ –í–∞–ª–∏–¥–Ω—ã–π —Ñ–æ—Ä–º–∞—Ç email

**Response (Success):**
```json
{
  "success": true,
  "user": {
    "id": "uuid",
    "email": "admin@example.com",
    "name": "Admin User",
    "role": "admin"
  }
}
```

**Response (Error - –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏ —É–∂–µ –µ—Å—Ç—å):**
```json
{
  "error": "Users already exist. Please use the login page."
}
```

## üîÑ –î–∏–∞–≥—Ä–∞–º–º–∞ –ø–æ—Ç–æ–∫–∞

```
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ –û—Ç–∫—Ä—ã—Ç—å     ‚îÇ
‚îÇ /admin      ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
       ‚îÇ
       ‚ñº
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ –ü—Ä–æ–≤–µ—Ä–∫–∞ users  ‚îÇ
‚îÇ –≤ –ë–î            ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îò
     ‚îÇ       ‚îÇ
     ‚îÇ       ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
     ‚îÇ                     ‚îÇ
 –ù–µ—Ç ‚îÇ                –ï—Å—Ç—å ‚îÇ
     ‚îÇ                     ‚îÇ
     ‚ñº                     ‚ñº
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê    ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ –†–µ–¥–∏—Ä–µ–∫—Ç –Ω–∞ ‚îÇ    ‚îÇ –ü–æ–∫–∞–∑–∞—Ç—å     ‚îÇ
‚îÇ create-new- ‚îÇ    ‚îÇ –∞–¥–º–∏–Ω-–ø–∞–Ω–µ–ª—å ‚îÇ
‚îÇ user        ‚îÇ    ‚îÇ (—Ç—Ä–µ–±—É–µ—Ç     ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò    ‚îÇ auth)        ‚îÇ
       ‚îÇ           ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
       ‚ñº
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ –§–æ—Ä–º–∞       ‚îÇ
‚îÇ —Å–æ–∑–¥–∞–Ω–∏—è    ‚îÇ
‚îÇ –ø–µ—Ä–≤–æ–≥–æ     ‚îÇ
‚îÇ admin       ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
       ‚îÇ
       ‚ñº
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ POST create-‚îÇ
‚îÇ first-user  ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
       ‚îÇ
       ‚ñº
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ –°–æ–∑–¥–∞–Ω user ‚îÇ
‚îÇ role: admin ‚îÇ
‚îÇ + –∞–≤—Ç–æ-–≤—Ö–æ–¥ ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
       ‚îÇ
       ‚ñº
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ –†–µ–¥–∏—Ä–µ–∫—Ç –Ω–∞ ‚îÇ
‚îÇ /admin      ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
```

## üß™ –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ

### –°—Ü–µ–Ω–∞—Ä–∏–π 1: –ü–µ—Ä–≤—ã–π –∑–∞–ø—É—Å–∫ —Å–∏—Å—Ç–µ–º—ã

1. **–û—á–∏—Å—Ç–∏—Ç–µ –ë–î:**
```bash
# –ü–µ—Ä–µ—Å–æ–∑–¥–∞–π—Ç–µ —Ç–∞–±–ª–∏—Ü—É users –±–µ–∑ –¥–∞–Ω–Ω—ã—Ö
npm run d1:migrate:users:local
```

2. **–û—Ç–∫—Ä–æ–π—Ç–µ –±—Ä–∞—É–∑–µ—Ä:**
```
http://localhost:3100/admin
```

3. **–û–∂–∏–¥–∞–µ—Ç—Å—è:** –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π —Ä–µ–¥–∏—Ä–µ–∫—Ç –Ω–∞ `/admin/create-new-user`

4. **–ó–∞–ø–æ–ª–Ω–∏—Ç–µ —Ñ–æ—Ä–º—É:**
   - Name: Admin User
   - Email: admin@example.com
   - Password: admin123456
   - Confirm Password: admin123456

5. **–ù–∞–∂–º–∏—Ç–µ "Create Admin User"**

6. **–û–∂–∏–¥–∞–µ—Ç—Å—è:** –†–µ–¥–∏—Ä–µ–∫—Ç –Ω–∞ `/admin` —Å –¥–æ—Å—Ç—É–ø–æ–º –∫ –∞–¥–º–∏–Ω-–ø–∞–Ω–µ–ª–∏

### –°—Ü–µ–Ω–∞—Ä–∏–π 2: –ü–æ–ø—ã—Ç–∫–∞ —Å–æ–∑–¥–∞—Ç—å –≤—Ç–æ—Ä–æ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è —á–µ—Ä–µ–∑ —Ñ–æ—Ä–º—É

1. **–ü–æ—Å–ª–µ —Å–æ–∑–¥–∞–Ω–∏—è –ø–µ—Ä–≤–æ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –æ—Ç–∫—Ä–æ–π—Ç–µ:**
```
http://localhost:3100/admin/create-new-user
```

2. **–û–∂–∏–¥–∞–µ—Ç—Å—è:** –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π —Ä–µ–¥–∏—Ä–µ–∫—Ç –Ω–∞ `/login`

### –°—Ü–µ–Ω–∞—Ä–∏–π 3: –û–±—ã—á–Ω—ã–π –≤—Ö–æ–¥

1. **–û—Ç–∫—Ä–æ–π—Ç–µ:**
```
http://localhost:3100/login
```

2. **–í–≤–µ–¥–∏—Ç–µ —É—á–µ—Ç–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ:**
   - Email: admin@example.com
   - Password: admin123456

3. **–û–∂–∏–¥–∞–µ—Ç—Å—è:** –†–µ–¥–∏—Ä–µ–∫—Ç –Ω–∞ `/admin`

## üîí –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å

### –ó–∞—â–∏—Ç–∞ –æ—Ç –ø–æ–≤—Ç–æ—Ä–Ω–æ–≥–æ —Å–æ–∑–¥–∞–Ω–∏—è

API endpoint `/api/auth/create-first-user`:
- –í—Å–µ–≥–¥–∞ –ø—Ä–æ–≤–µ—Ä—è–µ—Ç `COUNT(*)` –≤ —Ç–∞–±–ª–∏—Ü–µ users
- –ï—Å–ª–∏ `count > 0` ‚Üí –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç 403 Forbidden
- –ù–µ–≤–æ–∑–º–æ–∂–Ω–æ —Å–æ–∑–¥–∞—Ç—å –≤—Ç–æ—Ä–æ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è —á–µ—Ä–µ–∑ —ç—Ç–æ—Ç endpoint

### –ó–∞—â–∏—Ç–∞ —Ä–æ—É—Ç–æ–≤

- `/admin/*` –∑–∞—â–∏—â–µ–Ω middleware (—Ç—Ä–µ–±—É–µ—Ç —Ä–æ–ª—å admin)
- –í—Å–µ –ø–∞—Ä–æ–ª–∏ —Ö–µ—à–∏—Ä—É—é—Ç—Å—è SHA-256
- –°–µ—Å—Å–∏–∏ –∑–∞—à–∏—Ñ—Ä–æ–≤–∞–Ω—ã AES-GCM

## üìù –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–æ

### –°–æ–∑–¥–∞–Ω–∏–µ –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π

–ü–æ—Å–ª–µ —Å–æ–∑–¥–∞–Ω–∏—è –ø–µ—Ä–≤–æ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è, –Ω–æ–≤—ã—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π –º–æ–∂–Ω–æ —Å–æ–∑–¥–∞–≤–∞—Ç—å:
1. –ù–∞–ø—Ä—è–º—É—é –≤ –ë–î (—Å –ø–æ–º–æ—â—å—é `npm run hash-password`)
2. –ß–µ—Ä–µ–∑ –±—É–¥—É—â–∏–π API endpoint –¥–ª—è —Å–æ–∑–¥–∞–Ω–∏—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–æ–º

### –°–±—Ä–æ—Å —Å–∏—Å—Ç–µ–º—ã

–î–ª—è –ø–æ–ª–Ω–æ–≥–æ —Å–±—Ä–æ—Å–∞ –∏ –ø–æ–≤—Ç–æ—Ä–Ω–æ–≥–æ —Å–æ–∑–¥–∞–Ω–∏—è –ø–µ—Ä–≤–æ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è:
```bash
# –û—á–∏—Å—Ç–∏—Ç–µ —Ç–∞–±–ª–∏—Ü—É users
npm run d1:query:local
# –í –∏–Ω—Ç–µ—Ä–∞–∫—Ç–∏–≤–Ω–æ–º —Ä–µ–∂–∏–º–µ:
DELETE FROM users;
```

–ó–∞—Ç–µ–º —Å–Ω–æ–≤–∞ –æ—Ç–∫—Ä–æ–π—Ç–µ `/admin` - —Å–∏—Å—Ç–µ–º–∞ –ø—Ä–µ–¥–ª–æ–∂–∏—Ç —Å–æ–∑–¥–∞—Ç—å –ø–µ—Ä–≤–æ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è.


